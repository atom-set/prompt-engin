# File Write

> **文件说明**：本文件包含 file write 相关规则
> **规则来源**：rules/stages/common/mode/act/file-write.md

---

#### 文件写入规则

**核心原则**：**优先写入框架，然后再补充**

所有文件写入操作都应遵循"先框架后内容"的策略，确保文件结构完整，避免写入中断。

- **通用规则**（适用于所有文件写入）：
  - ✅ **必须遵循**：优先写入文件框架结构，再逐步填充内容
  - ✅ **标准流程**：框架 → 填充 → 验证
  - ⚠️ **禁止行为**：禁止一次性写入完整的复杂文件内容

- **适用场景**（满足任一条件即必须分步写入）：
  - 文件内容超过 **200 行**或 **10KB**
  - 包含 **2 个以上**逻辑模块或章节
  - 包含多个代码块、图表、表格等复杂内容
  - 需要分步骤填充的任何文件
  
- **标准操作流程**（强制遵循）：

  1. **第一步：写入框架**（必须优先执行）
     - 创建文件，写入完整的结构骨架
     - 包含所有主要标题层级（H1、H2、H3等）
     - 在需要填充内容的位置添加占位符
     - 确保文件结构完整，可以正常保存
     - **占位符格式**：
       - Markdown: `<!-- TODO: 填充XXX内容 -->`
       - 代码文件: `// TODO: 实现XXX功能`
       - 配置文件: `# TODO: 配置XXX项`
     - **框架示例**：
       ```markdown
       # 文档标题
       
       > **文档版本**: v1.0.0
       > **创建时间**: [运行 date '+%Y-%m-%d' 获取]
       
       ## 📑 目录导航
       <!-- TODO: 填充目录 -->
       
       ## 一、概述
       <!-- TODO: 填充概述内容 -->
       
       ## 二、详细内容
       <!-- TODO: 填充详细内容 -->
       
       ## 三、总结
       <!-- TODO: 填充总结内容 -->
       ```
  
  2. **第二步：按模块填充**（逐步执行）
     - 按照逻辑顺序，逐个模块填充内容
     - 使用 `search_replace` 工具替换占位符
     - **每次只填充一个模块**，确保内容完整
     - 填充顺序：按依赖关系，先填充被依赖的模块
  
  3. **第三步：验证完整性**（必须执行）
     - 检查是否还有占位符（搜索 `TODO:`）
     - 验证文件结构正确性
     - 确保所有模块内容完整

- **快速判断标准**（写入前必须评估）：
  - **简单文件**（<200 行，1-2 个模块）：可以直接写入完整内容
  - **中等文件**（200-500 行，2-3 个模块）：建议分步写入
  - **复杂文件**（>500 行，3+ 个模块）：必须分步写入

- **执行检查清单**（使用 `write` 工具前）：
  1. ✅ 已评估文件复杂度（行数/模块数）
  2. ✅ 已判断是否需要分步写入
  3. ✅ 如果适用，已准备框架结构和占位符
  4. ✅ 如果适用，已规划模块填充顺序

- **优势**：
  - ✅ 避免写入中断导致的内容丢失
  - ✅ 即使中断，也能保留文件框架结构
  - ✅ 便于分步骤验证和调整
  - ✅ 降低写入失败风险
  - ✅ 提高代码/文档质量

- **禁止的做法**：
  - ❌ 禁止一次性写入超过 200 行的复杂文件
  - ❌ 禁止跳过框架直接写入完整内容
  - ❌ 禁止在未评估复杂度的情况下使用 `write` 工具
  - ❌ 禁止一次性填充多个模块

- **正确示例**：
  ```markdown
  # ✅ 正确：先写入框架
  write("docs/design.md", "# 设计方案\n\n## 一、概述\n<!-- TODO: 填充概述 -->\n\n## 二、架构\n<!-- TODO: 填充架构 -->")
  
  # ✅ 正确：逐步填充
  search_replace("docs/design.md", "<!-- TODO: 填充概述 -->", "概述内容...")
  search_replace("docs/design.md", "<!-- TODO: 填充架构 -->", "架构内容...")
  ```

- **错误示例**：
  ```markdown
  # ❌ 错误：一次性写入完整内容（超过 200 行）
  write("docs/design.md", "完整的长文档内容（200+ 行）...")
  ```

---