# 文档生成规范

> **文件说明**：本文件包含所有文档类型的生成规范，整合技术方案、架构图、WIKI 等文档类型的规范
> **创建时间**：2025-12-18（本地时间）
> **相关文件**：
> - `architecture-diagram-template.md` - 架构图文档的详细规范（快速参考）
> - `wiki-output.md` - WIKI 文档的详细规范（快速参考）

---

## 概述

本文件定义了所有文档类型的生成规范，包括技术方案文档、架构图文档、WIKI 文档等。这是文档生成的整合版规范，提供了统一的文档生成规范，适用于所有需要结构化生成的技术文档。

---

**重要说明**：
- ✅ **本文件是整合版**：包含了所有文档类型的核心规范
- ✅ **推荐优先使用**：建议优先使用本文件，它提供了统一的文档生成规范
- ⚠️ **详细参考**：如果需要特定文档类型的详细规范，可以查看对应的专门规范文件：
  - 架构图文档：`architecture-diagram-template.md`（提供更详细的图表组织要求和示例）
  - WIKI 文档：`wiki-output.md`（提供更详细的 WIKI 文档格式要求和工具说明）

---

## 📑 目录导航

- [一、概述](#一概述)
- [二、通用规范](#二通用规范)
- [三、技术方案文档规范](#三技术方案文档规范)
- [四、架构图文档规范](#四架构图文档规范)
- [五、WIKI 文档规范](#五wiki-文档规范)
- [六、使用指南](#六使用指南)

---

## 一、概述

### 1.1 核心原则

- **结构清晰**：所有文档必须结构清晰、易于导航、便于维护
- **格式统一**：遵循统一的格式规范，保持文档风格一致
- **内容完整**：提供充分的信息，避免信息缺失
- **时间准确**：所有时间信息必须使用实际时间，禁止使用假设日期

### 1.2 适用范围

本规范适用于以下文档类型：

- ✅ **技术方案文档**：技术方案、设计方案、实施方案等
- ✅ **架构图文档**：系统架构图、模块架构图、流程图等
- ✅ **WIKI 文档**：项目文档、技术文档、使用说明等
- ✅ **其他技术文档**：任何需要结构化生成的技术文档

### 1.3 文档类型说明

| 文档类型 | 模板文件 | 规范说明 |
|---------|---------|---------|
| 技术方案文档 | `prompts/templates/technical-solution-template.md` | 12个主要章节，包含概述、需求背景、架构设计、设计方案等 |
| 架构图文档 | 无独立模板 | 图表模块化、说明可折叠、便于导航 |
| WIKI 文档 | 无独立模板 | 总分总结构、易于导航、便于维护 |

---

## 二、通用规范

### 2.1 文档结构要求

#### 基本结构

所有文档都应遵循清晰的结构：

1. **文档元信息**（可选但推荐）：
   ```markdown
   > **文档版本**: v1.0  
   > **创建时间**: {实际日期}（本地时间）  
   > **最后更新**: {实际日期}（本地时间）  
   > **适用范围**: {适用范围描述}
   ```

2. **目录导航**（长文档必须包含）：
   - 文档超过 3 个主要章节时，应在开头提供目录
   - 使用 Markdown 的锚点链接，支持多级目录
   - 目录位置：紧跟在文档标题后

3. **文档主体**：
   - 按照逻辑顺序组织内容
   - 使用清晰的标题层级（H1、H2、H3、H4）
   - 建议不超过 4 级标题

4. **总结部分**（可选）：
   - 总结文档的核心要点
   - 提供相关链接和参考资料

#### 标题层级要求

- **一级标题（H1）**：文档主标题，每个文档只有一个
- **二级标题（H2）**：主要章节，用于划分文档的主要部分
- **三级标题（H3）**：小节标题，用于细分章节内容
- **四级标题（H4）**：子小节标题，用于进一步细分
- **层级限制**：建议不超过 4 级标题，保持结构简洁

### 2.2 时间格式要求

**强制要求**：所有时间字段都必须使用实际时间，禁止使用假设日期！

#### 获取时间方法

**必须使用工具获取当前时间**：

```bash
# 获取 YYYY-MM-DD 格式的日期
date '+%Y-%m-%d'

# 获取完整日期时间
date '+%Y-%m-%d %H:%M:%S'
```

#### 禁止的时间值

- ❌ **禁止任何具体日期**：如 `2025-01-21`、`2025-12-01` 等
- ❌ **禁止格式占位符**：如 `YYYY-MM-DD`、`{当前日期}` 等
- ❌ **禁止模糊表述**：如"今天"、"当前日期"等

#### 时间格式规范

| 格式类型 | 格式定义 | 说明 |
|---------|---------|------|
| 日期 | YYYY-MM-DD | 4位年-2位月-2位日 |
| 日期时间 | YYYY-MM-DD HH:MM:SS | 包含时分秒 |
| 带时区 | YYYY-MM-DD（本地时间） | 标注时区 |

### 2.3 内容格式要求

#### 文本格式

- **强调**：使用 `**粗体**` 强调重要信息，使用 `*斜体*` 表示次要强调
- **代码引用**：行内代码使用反引号 `` `code` ``，代码块使用三个反引号
- **列表**：使用有序列表表示步骤，使用无序列表表示并列项
- **引用**：使用 `>` 表示引用内容

#### 表格格式

- **必须使用表格形式展示结构化数据**
- **表格对齐**：左对齐文本，右对齐数字
- **表格标题**：复杂表格应添加标题或说明
- **示例格式**：
  ```markdown
  | 列1 | 列2 | 列3 |
  |-----|-----|-----|
  | 数据1 | 数据2 | 数据3 |
  ```

#### 代码块格式

- **必须指定语言**：代码块必须标注语言类型（如 `python`、`bash`、`javascript`、`typescript`）
- **代码注释**：复杂代码应添加注释说明
- **代码示例**：提供完整可运行的代码示例，避免片段代码
- **代码位置**：如果代码来自项目文件，应标注文件路径

#### 流程图格式

- **使用 Mermaid 格式**：流程图使用 Mermaid 语法
- **必须指定图表类型**：flowchart、graph、sequenceDiagram 等
- **图表标题**：每个图表前必须有清晰的标题
- **图表说明**：复杂图表应在图表后添加简要说明

#### 图片和图表

- **图片格式**：优先使用 PNG 或 SVG 格式
- **图片背景**：所有图片必须使用白色背景（白底）
- **图片说明**：所有图片必须包含说明文字
- **图片路径**：使用相对路径，统一存放在 `images/` 或项目根目录的 `assets/` 目录

---

## 三、技术方案文档规范

### 3.1 模板引用

**模板文件**：`prompts/templates/technical-solution-template.md`

**模板说明**：技术方案文档应基于此模板生成，模板包含完整的文档结构和占位符。

### 3.2 文档结构要求

技术方案文档必须包含以下 **12 个主要章节**：

1. **一、概述**（必需）
   - 1.1 项目背景（现状问题、改造目标）
   - 1.2 核心价值
   - 1.3 技术亮点

2. **二、需求背景与约束条件**（必需）
   - 2.1 业务需求
   - 2.2 技术约束
   - 2.3 性能要求

3. **三、整体架构设计**（必需）
   - 3.1 架构视图
   - 3.2 核心模块说明

4. **四、设计方案**（必需）
   - 4.1 设计方案1
   - 4.2 设计方案2
   - 4.3 设计方案3
   - 4.4 设计方案4

5. **五、流程图设计**（必需）
   - 使用 Mermaid 格式的流程图

6. **六、前端实现**（必需）
   - 6.1 前端实现模块1
   - 6.2 前端实现模块2
   - 6.3 前端实现模块3

7. **七、Node服务端实现**（可选）
   - 仅在需要后端支持时包含
   - 纯前端项目可以跳过此章节

8. **八、关键技术实现细节**（必需）
   - 8.1 技术细节1
   - 8.2 技术细节2
   - 8.3 技术细节3
   - 8.4 技术细节4

9. **九、监控和日志设计**（必需）
   - 9.1 统计信息
   - 9.2 监控功能
   - 9.3 日志记录

10. **十、风险评估和应对措施**（必需）
    - 10.1 技术风险
    - 10.2 性能风险
    - 10.3 业务风险

11. **十一、代码改动总结**（必需）
    - 11.1 代码统计
    - 11.2 核心文件清单
    - 11.3 主要改动说明

12. **十二、总结**（必需）
    - 12.1 技术成果
    - 12.2 性能提升
    - 12.3 可靠性提升
    - 12.4 可维护性提升
    - 12.5 后续优化建议

### 3.3 生成要求

#### 使用模板生成

**提示词模板**：

```
请基于技术方案模板（prompts/templates/technical-solution-template.md）生成一份完整的技术方案文档。

**项目信息**：
- 项目名称：{项目名称}
- 技术栈：{技术栈}
- 业务场景：{业务场景}
- 架构类型：{架构类型}

**要求**：
1. 必须遵循模板的结构和格式规范
2. 所有占位符必须替换为实际内容，不能保留占位符文本
3. 时间字段必须使用实际时间（运行 date '+%Y-%m-%d' 获取），禁止使用假设日期
4. 代码示例必须完整可运行，避免片段代码
5. 流程图使用 Mermaid 格式，必须指定图表类型
6. 表格必须使用表格形式展示结构化数据
7. 如果项目不需要后端支持，可以跳过"七、Node服务端实现"章节
8. 所有章节都必须有实际内容，不能只有占位符

**输出要求**：
- 生成完整的技术方案文档
- 文档必须包含所有必需章节（1-6、8-12）
- 根据项目实际情况决定是否包含可选章节（7）
- 文档格式必须符合模板规范
```

#### 占位符替换要求

模板中使用以下占位符，使用时必须替换为实际内容：

- `{项目名称}`：项目或功能名称
- `{技术栈}`：使用的技术栈
- `{业务场景}`：业务场景描述
- `{架构类型}`：架构类型（如：四层架构、三层架构等）
- `{实现细节}`：具体实现细节

**重要**：所有占位符必须替换，不能保留占位符文本。

### 3.4 格式要求

- **文档元信息**：必须包含版本、创建时间、适用范围等
- **目录导航**：必须包含完整的目录导航
- **代码示例**：必须完整可运行，指定语言类型
- **流程图**：使用 Mermaid 格式，必须指定图表类型
- **表格**：必须使用表格形式展示结构化数据

---

## 四、架构图文档规范

### 4.1 核心原则

- **结构清晰**：架构图文档必须结构清晰、图表模块化、说明可折叠、便于导航
- **图表模块化**：大图表必须拆分成多个小模块，提高可读性和加载性能
- **说明可折叠**：详细说明必须默认折叠，使用 HTML `<details>` 标签

### 4.2 文档结构要求

#### 基本结构

架构图文档必须遵循以下结构：

```markdown
# [项目/系统名称] 技术架构图

## 📑 目录导航

- [一、整体架构图](#一整体架构图)
  - [1.1 章节名称](#11-章节名称)
  - [1.2 章节名称](#12-章节名称)
- [二、模块说明](#二模块说明)
- [三、配置说明](#三配置说明)

---

## 一、整体架构图

### 1.1 章节名称

#### 1.1.1 子模块1架构图
[图表]

#### 1.1.2 子模块2架构图
[图表]

#### 1.1.3 整体架构关系图
[简化版关系图]

## 二、模块说明

<details>
<summary><strong>📖 点击展开模块说明</strong></summary>

[详细说明内容]

</details>
```

### 4.3 图表组织要求

#### 大图表拆分原则

**核心原则**：大图表必须拆分成多个小模块，提高可读性和加载性能

**拆分标准**：
- **参与者数量**：如果图表包含 8 个以上参与者，应拆分
- **嵌套层级**：如果图表包含 3 层以上嵌套，应拆分
- **子图数量**：如果图表包含 3 个以上独立子图，应拆分
- **复杂度**：如果图表信息密度过高，难以理解，应拆分

**拆分方式**：
1. **按功能模块拆分**：将大图拆分成多个功能模块的独立图表
2. **按业务流程拆分**：将复杂流程拆分成多个子流程
3. **拆分后的组织方式**：先提供拆分的模块图表，再提供整体关系图

#### 图表类型组织

- **架构图（graph TB/LR）**：展示系统架构、模块关系
- **流程图（flowchart TD）**：展示业务流程、决策流程
- **时序图（sequenceDiagram）**：展示模块间交互、数据流转
- **关系图（简化版）**：展示整体关系、模块间关联

#### 图表颜色方案

建议使用以下颜色方案：

- **核心模块**：`#fff4e1`（浅黄色）
- **重要节点**：`#e8f5e9`（浅绿色）
- **辅助模块**：`#fce4ec`（浅粉色）
- **错误/警告**：`#ffebee`（浅红色）
- **信息提示**：`#e3f2fd`（浅蓝色）
- **普通节点**：`#e1f5ff`（浅青色）

### 4.4 说明部分组织要求

#### 说明部分默认折叠

**核心原则**：架构图下方的详细说明必须默认折叠，使用 HTML `<details>` 标签

**折叠范围**：
1. **模块说明**：模块功能、特性说明
2. **配置说明**：默认配置、配置说明、使用说明
3. **技术要点**：技术细节、实现原理
4. **代码示例**：完整的代码示例（超过 20 行）
5. **详细说明**：任何超过 5 行的详细说明

**折叠格式**：

```markdown
### 2.1 模块说明

<details>
<summary><strong>📖 点击展开模块说明</strong></summary>

[详细说明内容]

</details>
```

### 4.5 适用场景

**以下类型的架构图文档应遵循此规范：**

- ✅ **系统架构图**：系统整体架构、模块架构
- ✅ **技术架构图**：技术栈架构、框架架构
- ✅ **流程图**：业务流程、数据流转、决策流程
- ✅ **模块架构图**：功能模块架构、组件架构
- ✅ **其他架构图**：任何需要展示架构和流程的文档

---

## 五、WIKI 文档规范

### 5.1 核心原则

- **结构清晰**：WIKI 文档必须结构清晰、易于导航、便于维护
- **总分总结构**：WIKI 文档必须遵循总分总结构，确保内容逻辑清晰

### 5.2 文档结构要求

#### 基本结构（总分总格式）

WIKI 文档必须遵循**总分总结构**：

1. **总（开头）**：文档概述
   - 提供文档的目的、背景和核心内容概述
   - 包含文档目录（如果文档较长）
   - 简要说明文档要解决的问题或要传达的信息

2. **分（主体）**：详细内容部分
   - 按照逻辑顺序组织内容，使用清晰的标题层级
   - 每个小节应有明确的主题，内容详实
   - 可以包括：详细说明、代码示例、配置说明、使用场景等

3. **总（结尾）**：总结部分
   - 总结文档的核心要点
   - 提供相关链接和参考资料
   - 可以包括：关键信息汇总、下一步行动、相关文档链接等

### 5.3 Mermaid 图表转换工具

WIKI 文档中的 Mermaid 图表应使用转换工具转换为 PNG 图片：

#### 单个转换工具

- **工具位置**：`scripts/utils/mermaid_to_png.sh`
- **功能说明**：将 Mermaid 流程图代码转换为 PNG 图片文件（自动使用白色背景）
- **使用场景**：当 WIKI 平台不支持 Mermaid 渲染时，使用此工具生成图片

**使用方法**：

```bash
# 从文件转换
bash scripts/utils/mermaid_to_png.sh input.mmd [output_dir] [output_name]

# 从标准输入转换
echo "graph TD; A-->B" | bash scripts/utils/mermaid_to_png.sh [output_dir] [output_name]
```

#### 批量转换工具

- **工具位置**：`scripts/utils/extract_and_convert_mermaid.py`
- **功能说明**：自动提取 Markdown 文档中的所有 Mermaid 图表，根据章节标题自动命名并批量转换为 PNG 图片
- **使用场景**：将包含多个 Mermaid 图表的 Markdown 文档转换为 WIKI 版本

**使用方法**：

```bash
python3 scripts/utils/extract_and_convert_mermaid.py <markdown_file> [output_dir]
```

### 5.4 文档元信息

每个 WIKI 文档应在开头包含以下元信息（可选，但推荐）：

```markdown
---
title: 文档标题
description: 文档描述
author: 作者
created: YYYY-MM-DD（本地时间）  # 必须使用文档实际创建时间，禁止使用假设日期
updated: YYYY-MM-DD（本地时间）  # 必须使用文档实际更新时间，禁止使用假设日期
version: 1.0
tags: [标签1, 标签2]
---
```

### 5.5 适用场景

**以下类型的 WIKI 文档应遵循此规范：**

- ✅ **项目文档**：项目介绍、架构说明、开发指南等
- ✅ **技术文档**：API 文档、技术方案、设计文档等
- ✅ **使用说明**：用户手册、操作指南、配置说明等
- ✅ **知识库**：常见问题、最佳实践、经验总结等
- ✅ **其他 WIKI 文档**：任何需要在 WIKI 中展示的文档

---

## 六、使用指南

### 6.1 如何选择文档类型

根据文档用途选择合适的文档类型：

| 文档用途 | 推荐文档类型 | 模板/规范 |
|---------|------------|----------|
| 技术方案、设计方案 | 技术方案文档 | `templates/technical-solution-template.md` |
| 系统架构、模块架构 | 架构图文档 | 本规范第四章 |
| 项目文档、使用说明 | WIKI 文档 | 本规范第五章 |

### 6.2 生成文档流程

#### 步骤1：选择文档类型

根据文档用途选择合适的文档类型。

#### 步骤2：准备项目信息

收集以下信息：
- 项目名称、技术栈、业务场景
- 架构类型、核心模块
- 关键技术实现细节

#### 步骤3：使用模板或规范生成

- **技术方案文档**：使用 `templates/technical-solution-template.md` 模板
- **架构图文档**：遵循本规范第四章的要求
- **WIKI 文档**：遵循本规范第五章的要求

#### 步骤4：检查和完善

- 检查所有占位符是否已替换
- 验证时间字段是否使用实际时间
- 确认代码示例是否完整可运行
- 检查流程图和表格格式是否正确

### 6.3 常见问题

#### Q1：技术方案文档必须包含所有章节吗？

**A1**：必需章节（1-6、8-12）必须包含，可选章节（7）根据项目实际情况决定是否包含。

#### Q2：架构图文档必须拆分大图表吗？

**A2**：如果图表包含 8 个以上参与者或 3 层以上嵌套，必须拆分。

#### Q3：WIKI 文档必须使用总分总结构吗？

**A3**：是的，WIKI 文档必须遵循总分总结构，确保内容逻辑清晰。

#### Q4：时间字段可以使用假设日期吗？

**A4**：禁止！所有时间字段必须使用实际时间（运行 `date '+%Y-%m-%d'` 获取），禁止使用假设日期。

### 6.4 最佳实践

1. **内容完整性**：
   - 确保所有章节都有实际内容，不能只有占位符
   - 每个章节应包含足够的细节说明
   - 代码示例应完整可运行

2. **结构清晰性**：
   - 使用清晰的标题层级（H1、H2、H3、H4）
   - 章节之间使用分隔线区分
   - 重要内容使用强调格式（粗体、列表等）

3. **可读性**：
   - 使用表格展示结构化数据
   - 使用代码块展示代码示例
   - 使用流程图展示复杂流程
   - 使用列表展示并列项

4. **准确性**：
   - 所有技术细节应准确无误
   - 代码示例应经过验证
   - 数据统计应真实可靠
   - 时间信息必须使用实际时间

5. **灵活性**：
   - 根据项目实际情况调整章节内容
   - 可选章节可以根据需要包含或跳过
   - 占位符应根据实际情况替换

---

## 重要原则

1. **结构清晰**：确保文档结构层次分明，易于导航
2. **内容完整**：提供充分的信息，避免信息缺失
3. **格式统一**：遵循统一的格式规范，保持文档风格一致
4. **易于维护**：文档应易于更新和维护，避免冗余内容
5. **用户友好**：从读者角度组织内容，提供清晰的导航和链接
6. **时间准确**：所有时间信息必须使用本地时间，并标注时区
7. **禁止假设**：禁止使用假设日期，必须使用实际时间

---

## 注意事项

1. **强制要求**：所有文档必须遵循相应的规范，这是强制要求，不是建议
2. **时间要求**：时间信息必须使用实际时间，禁止使用固定的假设日期
3. **格式要求**：所有文档必须遵循格式规范，保持风格一致
4. **模板使用**：技术方案文档必须基于模板生成，不能跳过模板
5. **占位符替换**：所有占位符必须替换为实际内容，不能保留占位符文本
