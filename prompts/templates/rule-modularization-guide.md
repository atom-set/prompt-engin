# 规则模块化拆分指南

> **文档版本**: v1.0.0  
> **创建时间**: 2025-12-12（本地时间）  
> **用途**: 新增规则库时的拆分约束和检查标准

---

## 概述

本文件定义了规则模块化拆分指南，包括拆分标准、拆分原则、检查标准等。适用于新增规则库时的拆分约束和检查，确保规则文件结构清晰、职责单一、易于维护。

---

## 📑 目录导航

- [一、核心原则](#一核心原则)
- [二、拆分标准](#二拆分标准)
- [三、功能单一性检查](#三功能单一性检查)
- [四、可扩展性要求](#四可扩展性要求)
- [五、目录组织规范](#五目录组织规范)
- [六、索引文件要求](#六索引文件要求)
- [七、检查清单](#七检查清单)
- [八、提示词模板](#八提示词模板)

---

## 一、核心原则

### 1.1 功能单一原则

**要求**：每个规则模块只负责一个明确的功能领域

**检查标准**：
- ✅ 模块职责描述清晰，不超过一句话
- ✅ 模块之间职责边界清晰，无重叠
- ✅ 模块可以独立理解和使用
- ❌ 禁止一个模块包含多个不相关的功能

**示例**：
```markdown
✅ 好的模块：文件写入规则（只负责文件写入相关规则）
❌ 不好的模块：文件操作规则（包含写入、读取、删除等多个功能）
```

### 1.2 可扩展原则

**要求**：每个规则模块都有明确的扩展点和扩展指南

**检查标准**：
- ✅ 模块包含"扩展点"章节，明确标识可扩展的地方
- ✅ 模块包含"扩展指南"，说明如何添加新功能
- ✅ 添加新功能不影响其他模块
- ❌ 禁止硬编码限制，导致无法扩展

**示例**：
```markdown
✅ 好的扩展点：
## 扩展点
### 1. 写入策略扩展
可以在 `写入策略选择` 章节添加新的写入策略：
- 当前策略：框架优先、分步填充
- 可扩展：批量写入、增量写入、模板写入等

❌ 不好的扩展点：
（没有扩展点说明，无法知道如何扩展）
```

### 1.3 适度拆分原则

**要求**：只拆分超过 500 行的文件，按功能领域拆分

**检查标准**：
- ✅ 文件超过 500 行必须拆分
- ✅ 按功能领域拆分，不按小节拆分
- ✅ 保持模块的完整性和独立性
- ❌ 禁止过度拆分（每个小节一个文件）
- ❌ 禁止拆分不足（超过 500 行不拆分）

---

## 二、拆分标准

### 2.1 文件大小约束

| 文件大小 | 处理方式 | 说明 |
|---------|---------|------|
| **< 200 行** | ✅ 保持原样 | 文件较小，无需拆分 |
| **200-500 行** | ⚠️ 建议拆分 | 如果包含多个独立功能，建议拆分 |
| **> 500 行** | ❌ 必须拆分 | 强制要求拆分 |

### 2.2 功能模块识别

**识别方法**：
1. 分析文件的主要章节（H2、H3 标题）
2. 识别每个章节的功能职责
3. 判断章节之间是否独立
4. 判断章节是否可以独立扩展

**拆分判断标准**：
- ✅ 章节功能独立，可以单独使用
- ✅ 章节有明确的扩展点
- ✅ 章节之间依赖关系清晰
- ❌ 章节功能耦合，无法独立使用

### 2.3 模块大小控制

**目标大小**：每个模块 50-500 行

| 模块大小 | 评价 | 处理建议 |
|---------|------|---------|
| **< 50 行** | ⚠️ 过小 | 考虑合并到相关模块 |
| **50-200 行** | ✅ 合适 | 保持现状 |
| **200-500 行** | ✅ 合适 | 保持现状 |
| **> 500 行** | ❌ 过大 | 必须进一步拆分 |

---

## 三、功能单一性检查

### 3.1 职责描述检查

**检查项**：
- [ ] 模块标题清晰表达功能领域
- [ ] 模块开头有明确的职责说明
- [ ] 职责描述不超过一句话
- [ ] 职责边界清晰，无歧义

**检查模板**：
```markdown
## [模块名称]

> **职责说明**：[一句话描述模块职责]

[模块内容]
```

### 3.2 功能边界检查

**检查项**：
- [ ] 模块内容只涉及一个功能领域
- [ ] 模块之间无功能重叠
- [ ] 模块可以独立理解和使用
- [ ] 模块不依赖其他模块的具体实现

**检查方法**：
1. 列出模块的所有章节标题
2. 检查章节是否都属于同一功能领域
3. 检查是否有章节可以独立成模块
4. 检查是否有章节与其他模块重叠

### 3.3 独立性检查

**检查项**：
- [ ] 模块可以独立阅读和理解
- [ ] 模块不依赖其他模块的具体内容
- [ ] 模块通过索引文件与其他模块连接
- [ ] 模块修改不影响其他模块

---

## 四、可扩展性要求

### 4.1 扩展点标识

**要求**：每个模块必须包含"扩展点"章节

**格式要求**：
```markdown
## 扩展点

### 1. [扩展点名称]
可以在 `[章节名称]` 章节添加新的[功能类型]：
- 当前实现：[当前实现说明]
- 可扩展：[可扩展的功能列表]

### 2. [扩展点名称]
...
```

**检查项**：
- [ ] 模块包含"扩展点"章节
- [ ] 每个扩展点有明确的说明
- [ ] 扩展点说明包含当前实现和可扩展功能
- [ ] 扩展点说明包含如何扩展的指南

### 4.2 扩展指南

**要求**：每个模块必须包含"扩展指南"章节

**格式要求**：
```markdown
## 扩展指南

### 如何添加新功能

1. **确定扩展点**：选择要扩展的功能点
2. **遵循原则**：遵循模块的核心原则
3. **更新文档**：更新相关文档和索引
4. **验证测试**：验证新功能不影响现有功能
```

**检查项**：
- [ ] 模块包含"扩展指南"章节
- [ ] 扩展指南包含具体的操作步骤
- [ ] 扩展指南包含注意事项
- [ ] 扩展指南包含验证方法

### 4.3 接口设计

**要求**：模块接口清晰，便于组合使用

**检查项**：
- [ ] 模块有清晰的输入输出说明
- [ ] 模块依赖关系明确
- [ ] 模块可以独立使用
- [ ] 模块可以组合使用

---

## 五、目录组织规范

### 5.1 目录结构要求

**标准结构**：
```
rules/stages/common/
├── [功能方向]/              # 功能方向目录（mode、code、document等）
│   ├── index.md            # 索引文件（必须）
│   ├── [子功能]/           # 子功能目录（可选）
│   │   ├── index.md        # 子功能索引（可选）
│   │   └── [模块].md       # 模块文件
│   └── [模块].md           # 模块文件（如果不需要子目录）
```

**命名规范**：
- 目录名：使用小写字母，单词间用连字符（kebab-case）
- 文件名：使用小写字母，单词间用连字符（kebab-case）
- 索引文件：统一命名为 `index.md`

### 5.2 目录分类标准

**功能方向分类**：
- **mode/**：模式相关规则（Plan、Act、Debug等）
- **code/**：代码规范规则（命名、函数、格式等）
- **document/**：文档规范规则（格式、时间等）
- **interaction/**：交互规范规则（确认机制等）
- **project/**：项目规范规则（项目清洁等）

**分类判断**：
1. 分析规则的主要功能领域
2. 判断规则属于哪个功能方向
3. 如果无法判断，创建新的功能方向目录

### 5.3 目录层级控制

**层级要求**：
- 最多 3 层：`功能方向/子功能/模块`
- 避免过深：超过 3 层需要重新设计
- 保持平衡：同一层级目录数量控制在 5-10 个

---

## 六、索引文件要求

### 6.1 索引文件位置

**要求**：
- 每个功能方向目录必须有 `index.md`
- 子功能目录建议有 `index.md`（如果模块数量 > 3）
- 索引文件放在目录的第一位（按字母排序）

### 6.2 索引文件内容

**必须包含**：
1. **目录导航**：列出所有模块的链接
2. **模块列表**：列出所有模块及其职责
3. **依赖关系**：说明模块之间的依赖关系
4. **使用说明**：如何使用这些模块

**可选包含**：
- 扩展指南：如何添加新模块
- 最佳实践：使用这些模块的最佳实践
- 常见问题：常见问题和解答

**格式模板**：
```markdown
# [功能方向] 规则索引

> **文件说明**：本文件是 [功能方向] 规则的索引文件
> **创建时间**：YYYY-MM-DD（本地时间）

## 📑 目录导航

- [模块1](#模块1) - [模块1说明]
- [模块2](#模块2) - [模块2说明]
- ...

## 模块列表

### 模块1：模块1名称
- **文件**：`module1.md`
- **职责**：[职责说明]
- **依赖**：[依赖的模块]
- **被依赖**：[依赖此模块的其他模块]

## 使用说明

[使用说明内容]

## 扩展指南

[如何添加新模块的指南]
```

### 6.3 索引文件维护

**维护要求**：
- 添加新模块时，更新索引文件
- 删除模块时，更新索引文件
- 修改模块职责时，更新索引文件
- 定期检查索引文件的准确性

---

## 七、检查清单

### 7.1 新增规则文件检查

**文件大小检查**：
- [ ] 文件行数 < 500 行（如果 > 500 行，必须拆分）
- [ ] 文件大小适中（50-500 行）

**功能单一性检查**：
- [ ] 模块职责描述清晰
- [ ] 模块只负责一个功能领域
- [ ] 模块之间无功能重叠
- [ ] 模块可以独立理解和使用

**可扩展性检查**：
- [ ] 模块包含"扩展点"章节
- [ ] 模块包含"扩展指南"章节
- [ ] 扩展点说明清晰
- [ ] 扩展指南包含操作步骤

**目录组织检查**：
- [ ] 文件放在正确的功能方向目录
- [ ] 目录结构符合规范
- [ ] 文件命名符合规范
- [ ] 索引文件已更新

### 7.2 拆分规则文件检查

**拆分必要性检查**：
- [ ] 文件行数 > 500 行（必须拆分）
- [ ] 文件包含多个独立功能模块
- [ ] 功能模块可以独立扩展

**拆分方案检查**：
- [ ] 拆分方案符合功能单一原则
- [ ] 拆分方案符合可扩展原则
- [ ] 拆分后的模块大小适中（50-500 行）
- [ ] 拆分后的模块职责清晰

**拆分实施检查**：
- [ ] 所有模块文件已创建
- [ ] 所有模块内容完整
- [ ] 所有路径引用已更新
- [ ] 所有索引文件已更新

### 7.3 目录结构检查

**目录组织检查**：
- [ ] 目录结构符合规范
- [ ] 目录层级不超过 3 层
- [ ] 目录命名符合规范
- [ ] 目录分类合理

**索引文件检查**：
- [ ] 所有功能方向目录都有 `index.md`
- [ ] 索引文件内容完整
- [ ] 索引文件链接正确
- [ ] 索引文件已更新

---

## 八、提示词模板

### 8.1 新增规则文件提示词

```
在创建新的规则文件时，请遵循以下约束和检查：

## 文件大小约束
- 文件行数必须 < 500 行
- 如果文件 > 500 行，必须拆分为多个模块
- 每个模块大小控制在 50-500 行

## 功能单一性要求
- 每个模块只负责一个明确的功能领域
- 模块职责描述清晰，不超过一句话
- 模块之间职责边界清晰，无重叠
- 模块可以独立理解和使用

## 可扩展性要求
- 模块必须包含"扩展点"章节，明确标识可扩展的地方
- 模块必须包含"扩展指南"章节，说明如何添加新功能
- 扩展点说明包含当前实现和可扩展功能
- 扩展指南包含具体的操作步骤

## 目录组织要求
- 文件必须放在正确的功能方向目录（mode、code、document、interaction、project）
- 目录结构符合规范（最多 3 层）
- 文件命名符合规范（kebab-case）
- 索引文件已更新

## 检查清单
请完成以下检查：
- [ ] 文件行数 < 500 行
- [ ] 模块职责描述清晰
- [ ] 模块包含扩展点和扩展指南
- [ ] 文件放在正确的目录
- [ ] 索引文件已更新
```

### 8.2 拆分规则文件提示词

```
在拆分规则文件时，请遵循以下约束和检查：

## 拆分标准
- 文件 > 500 行必须拆分
- 按功能领域拆分，不按小节拆分
- 每个模块大小控制在 50-500 行
- 保持模块的完整性和独立性

## 功能模块识别
1. 分析文件的主要章节（H2、H3 标题）
2. 识别每个章节的功能职责
3. 判断章节之间是否独立
4. 判断章节是否可以独立扩展

## 拆分方案设计
- 拆分方案符合功能单一原则
- 拆分方案符合可扩展原则
- 拆分后的模块职责清晰
- 拆分后的模块可以独立使用

## 拆分实施
1. 创建模块文件
2. 移动内容到对应模块
3. 更新路径引用
4. 更新索引文件
5. 验证拆分结果

## 检查清单
请完成以下检查：
- [ ] 拆分方案符合功能单一和可扩展原则
- [ ] 所有模块文件已创建
- [ ] 所有模块内容完整
- [ ] 所有路径引用已更新
- [ ] 所有索引文件已更新
```

### 8.3 目录组织提示词

```
在组织规则目录时，请遵循以下约束和检查：

## 目录结构要求
- 标准结构：功能方向/子功能/模块
- 最多 3 层目录
- 目录命名使用 kebab-case
- 每个功能方向目录必须有 index.md

## 功能方向分类
- mode/：模式相关规则
- code/：代码规范规则
- document/：文档规范规则
- interaction/：交互规范规则
- project/：项目规范规则

## 索引文件要求
- 每个功能方向目录必须有 index.md
- 索引文件包含：目录导航、模块列表、依赖关系、使用说明
- 索引文件放在目录的第一位

## 检查清单
请完成以下检查：
- [ ] 目录结构符合规范
- [ ] 目录层级不超过 3 层
- [ ] 目录命名符合规范
- [ ] 所有功能方向目录都有 index.md
- [ ] 索引文件内容完整
```

---

## 九、使用示例

### 9.1 新增规则文件示例

**场景**：需要添加一个新的"代码审查规范"规则

**步骤**：
1. **检查文件大小**：预计 300 行，< 500 行，无需拆分
2. **确定功能方向**：属于代码规范，应放在 `code/` 目录
3. **创建文件**：`code/code-review.md`
4. **添加扩展点**：在文件中添加扩展点和扩展指南
5. **更新索引**：更新 `code/index.md`

### 9.2 拆分规则文件示例

**场景**：`code-style.md` 文件 597 行，需要拆分

**步骤**：
1. **识别功能模块**：命名规范、函数设计、代码格式、注释规范
2. **设计拆分方案**：拆分为 4 个模块
3. **创建模块文件**：
   - `code/naming/naming.md`
   - `code/function/function-design.md`
   - `code/format/code-format.md`
   - `code/comments/comments.md`
4. **更新索引文件**：更新所有相关索引文件

---

## 十、常见问题

### Q1：如何判断文件是否需要拆分？

**A1**：根据以下标准判断：
- 文件行数 > 500 行：必须拆分
- 文件包含多个独立功能模块：建议拆分
- 功能模块可以独立扩展：建议拆分

### Q2：如何确定功能方向？

**A2**：根据规则的主要功能领域判断：
- 模式相关：mode/
- 代码相关：code/
- 文档相关：document/
- 交互相关：interaction/
- 项目相关：project/

### Q3：索引文件必须包含哪些内容？

**A3**：必须包含：
- 目录导航
- 模块列表
- 依赖关系
- 使用说明

可选包含：
- 扩展指南
- 最佳实践
- 常见问题

---

**文档版本**：v1.0.0  
**创建时间**：2025-12-12（本地时间）  
**最后更新**：2025-12-12（本地时间）

