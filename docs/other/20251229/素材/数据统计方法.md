# 数据统计方法

> **文档说明**：本文档说明分享大纲中"实际效果"部分的数据统计方法  
> **创建时间**：2025-12-29（本地时间）

---

## 📋 目录

- [一、可统计数据](#一可统计数据)
- [二、统计方法](#二统计方法)
- [三、定性分析指标](#三定性分析指标)
- [四、统计脚本](#四统计脚本)

---

## 一、可统计数据

### 1.1 文件行数统计

**可统计的指标**：
- ✅ **初始 Token（行数）**：完整版 vs 精简版的行数对比

**统计文件**：
- 完整版：`.cursorrules.all` 或 `dist/cursor/single-full/.cursorrules`
- 精简版：`.cursorrules.core` 或 `dist/cursor/single-core/.cursorrules`

**统计方法**：
```bash
# 统计完整版行数
wc -l .cursorrules.all

# 统计精简版行数
wc -l .cursorrules.core

# 计算减少比例
full_lines=$(wc -l < .cursorrules.all)
core_lines=$(wc -l < .cursorrules.core)
reduction=$(( (full_lines - core_lines) * 100 / full_lines ))
echo "减少比例: ${reduction}%"
```

**当前统计结果**（2025-12-29）：
- 完整版：8597 行
- 精简版：3427 行
- 减少比例：60.1%

---

## 二、统计方法

### 2.1 文件行数统计

**方法1：使用 wc 命令**

```bash
# 统计单个文件
wc -l <filename>

# 统计多个文件
wc -l file1 file2 file3

# 只显示行数（不显示文件名）
wc -l < file1
```

**方法2：使用 Python 脚本**

```python
def count_lines(filepath):
    """统计文件行数"""
    with open(filepath, 'r', encoding='utf-8') as f:
        return len(f.readlines())

# 使用示例
full_lines = count_lines('.cursorrules.all')
core_lines = count_lines('.cursorrules.core')
reduction = (full_lines - core_lines) / full_lines * 100
print(f"完整版: {full_lines} 行")
print(f"精简版: {core_lines} 行")
print(f"减少比例: {reduction:.1f}%")
```

### 2.2 文件大小统计

**统计文件大小（KB）**：

```bash
# 使用 du 命令
du -h .cursorrules.all .cursorrules.core

# 使用 ls 命令
ls -lh .cursorrules.all .cursorrules.core

# 使用 stat 命令（macOS）
stat -f "%z" .cursorrules.all  # 字节数
stat -f "%z" .cursorrules.core
```

### 2.3 Token 估算

**注意**：Token 数量无法精确统计，只能估算。

**估算方法**：
- 1 Token ≈ 4 个字符（英文）
- 1 Token ≈ 1.5 个中文字符
- 行数可以作为 Token 的粗略参考（但不精确）

**建议**：
- 使用行数作为对比指标（更直观）
- 如需精确 Token 数，需要使用实际的 Token 计算工具（如 tiktoken）

---

## 三、定性分析指标

### 3.1 无法精确统计的指标

以下指标无法精确量化，只能进行定性分析：

1. **规则复用**：
   - 定性描述：从"每个项目重新编写"到"一次编写，多项目复用"
   - 无法量化：因为无法统计"节省的编写时间"

2. **维护成本**：
   - 定性描述：从"O(n)"到"O(1)"的复杂度降低
   - 无法量化：因为不同项目的维护成本差异很大

3. **同步效率**：
   - 定性描述：从"手动同步，容易遗漏"到"一键同步，自动更新"
   - 无法量化：因为同步时间取决于项目数量

4. **版本一致性**：
   - 定性描述：从"不同项目版本不一致"到"所有项目版本统一"
   - 无法量化：因为无法统计"版本不一致导致的问题数量"

5. **团队协作**：
   - 定性描述：从"风格不统一"到"标准化规范"
   - 无法量化：因为无法统计"协作效率提升的具体数值"

6. **个性化适配**：
   - 定性描述：从"一刀切"到"按角色、阶段选择"
   - 无法量化：因为无法统计"适配精准度的提升"

### 3.2 定性分析的表述方式

**推荐表述**：
- ✅ "显著提升"、"显著降低"（适用于有明显改善的指标）
- ✅ "从 X 到 Y"（适用于状态变化的指标）
- ✅ "O(n) 到 O(1)"（适用于复杂度变化的指标）

**避免表述**：
- ❌ 具体的百分比（如"提升 80%"）除非有实际统计数据支撑
- ❌ 绝对数值（如"节省 2 小时"）除非有实际统计数据支撑

---

## 四、统计脚本

### 4.1 快速统计脚本

创建 `scripts/utils/stat_metrics.sh`：

```bash
#!/bin/bash

# 统计 Prompt Engine 数据指标

echo "=== Prompt Engine 数据统计 ==="
echo ""

# 检查文件是否存在
if [ ! -f ".cursorrules.all" ] || [ ! -f ".cursorrules.core" ]; then
    echo "错误: 找不到统计文件"
    echo "请先生成规则文件:"
    echo "  python3 scripts/prompt-engine merge --all --ide cursor --output .cursorrules.all"
    echo "  python3 scripts/prompt-engine merge --core-only --ide cursor --output .cursorrules.core"
    exit 1
fi

# 统计行数
full_lines=$(wc -l < .cursorrules.all)
core_lines=$(wc -l < .cursorrules.core)
reduction=$(( (full_lines - core_lines) * 100 / full_lines ))

# 统计文件大小
full_size=$(du -h .cursorrules.all | cut -f1)
core_size=$(du -h .cursorrules.core | cut -f1)

echo "📊 文件行数统计:"
echo "  完整版: ${full_lines} 行"
echo "  精简版: ${core_lines} 行"
echo "  减少: $((full_lines - core_lines)) 行"
echo "  减少比例: ${reduction}%"
echo ""

echo "📦 文件大小统计:"
echo "  完整版: ${full_size}"
echo "  精简版: ${core_size}"
echo ""

echo "✅ 统计完成"
```

### 4.2 使用方法

```bash
# 赋予执行权限
chmod +x scripts/utils/stat_metrics.sh

# 运行统计脚本
bash scripts/utils/stat_metrics.sh
```

---

## 五、数据更新建议

### 5.1 何时更新数据

- ✅ 规则文件有重大变更时
- ✅ 生成新的规则文件版本时
- ✅ 分享前需要最新数据时

### 5.2 更新流程

1. **生成最新规则文件**：
   ```bash
   python3 scripts/prompt-engine merge --all --ide cursor --output .cursorrules.all
   python3 scripts/prompt-engine merge --core-only --ide cursor --output .cursorrules.core
   ```

2. **运行统计脚本**：
   ```bash
   bash scripts/utils/stat_metrics.sh
   ```

3. **更新分享大纲**：
   - 更新 `docs/other/20251229/分享大纲.md` 中的数据
   - 更新统计时间

---

## 六、注意事项

1. **数据准确性**：
   - 已统计数据：基于实际文件，准确可靠
   - 定性分析：基于功能特性，无法精确量化

2. **数据时效性**：
   - 文件行数会随着规则更新而变化
   - 分享前建议重新统计最新数据

3. **表述准确性**：
   - 已统计数据：可以使用具体数值和百分比
   - 定性分析：使用"显著"、"明显"等定性词汇，避免具体百分比

---

**最后更新**：2025-12-29（本地时间）

