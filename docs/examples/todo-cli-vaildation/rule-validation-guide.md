# 提示词规则验证指南

> **文档说明**：本指南提供完整的提示词规则验证方案，通过实际项目验证系统规则的效果
> **创建时间**：2025-12-15（本地时间）
> **项目名称**：待办事项管理 CLI 工具（Todo CLI）

---

## 📑 目录导航

- [一、项目概述](#一项目概述)
- [二、验证规则分类](#二验证规则分类)
- [三、提问词集合](#三提问词集合)
- [四、验证执行流程](#四验证执行流程)
- [五、验证结果记录](#五验证结果记录)
- [六、项目结构](#六项目结构)

---

## 一、项目概述

### 1.1 项目选择

**项目名称**：待办事项管理 CLI 工具（Todo CLI）

**项目描述**：
- 一个简单的命令行工具，用于管理待办事项
- 支持添加、删除、完成、列表查看、搜索等功能
- 使用 JSON 文件存储数据
- 使用 Python 实现

**选择理由**：
1. **复杂度适中**：能覆盖多种规则验证场景，但不会过于复杂
2. **功能明确**：需求清晰，便于设计验证用例
3. **技术栈简单**：Python CLI，易于实现和验证
4. **实际价值**：有实际使用场景，不是纯演示项目

### 1.2 核心功能

- ✅ 添加待办事项
- ✅ 删除待办事项
- ✅ 标记完成/未完成
- ✅ 列表查看（支持筛选）
- ✅ 搜索待办事项
- ✅ 数据持久化（JSON 文件）

---

## 二、验证规则分类

根据系统现有规则，设计以下验证场景：

### 2.1 模式规则验证

| 规则类别 | 规则文件 | 验证场景 | 预期行为 |
|---------|---------|---------|---------|
| **Plan 模式行为** | `mode/plan/behavior.md` | 用户描述需求时 | AI 应处于 Plan 模式，只输出方案，不执行修改 |
| **方案输出机制** | `mode/plan/solution-output.md` | 用户要求修改代码 | AI 必须输出完整方案（5部分），等待 "Act" 指令 |
| **工具调用检查** | `mode/plan/tool-check.md` | Plan 模式下要求修改 | AI 应拒绝调用文件修改工具，提醒需要 "Act" |
| **方案完整性检查** | `mode/plan/solution-completeness.md` | 用户输入 "Act" | AI 应检查方案完整性，完整才切换，否则补充 |
| **Act 模式切换** | `mode/common/mode-common.md` | 方案完整后输入 "Act" | AI 应切换到 Act 模式并执行 |
| **文件写入规则** | `mode/act/file-write.md` | Act 模式下创建文件 | AI 应先写框架，再逐步填充内容 |
| **长文本写入检查** | `mode/act/long-text-check.md` | 创建大文件 | AI 应检查文件大小，大文件分步写入 |
| **分阶段实施** | `mode/act/phase-implementation.md` | 大型工程 | AI 应分阶段实施，每阶段完成后询问 |

### 2.2 代码规范验证

| 规则类别 | 规则文件 | 验证场景 | 预期行为 |
|---------|---------|---------|---------|
| **命名规范** | `code/naming/naming.md` | 创建函数和变量 | 应遵循命名规范（camelCase、PascalCase 等） |
| **函数设计** | `code/function/function-design.md` | 设计函数 | 函数应简短、单一职责、避免嵌套 |
| **错误处理** | `code/error-handling/strategy.md` | 添加错误处理 | 应遵循错误处理策略，使用具体异常类型 |
| **问题定位** | `code/problem-location/problem-location.md` | 修复 Bug | 应先定位问题，再修复，不能盲目添加防御代码 |
| **代码组织** | `code/organization/code-organization.md` | 文件大小 | 新增文件不应超过 500 行 |

### 2.3 文档规范验证

| 规则类别 | 规则文件 | 验证场景 | 预期行为 |
|---------|---------|---------|---------|
| **时间格式** | `document/time-format.md` | 创建文档 | 必须使用 `date` 命令获取时间，禁止假设日期 |
| **文档格式** | `document/document-format.md` | 输出文档 | 应遵循文档格式规范，使用表格等 |
| **禁止 QA** | `document/document-format.md` | 创建文档 | 不应默认添加 FAQ 部分 |

### 2.4 交互规范验证

| 规则类别 | 规则文件 | 验证场景 | 预期行为 |
|---------|---------|---------|---------|
| **开放性问题** | `interaction/open-question-confirmation.md` | 技术选型 | 应询问用户偏好，不能假设 |
| **兼容性确认** | `mode/plan/compatibility-check.md` | API 调整 | 应询问是否需要向下兼容 |

---

## 三、提问词集合

### 场景1：Plan 模式行为验证

#### 提问词1：验证 Plan 模式默认行为

```
我需要创建一个待办事项管理 CLI 工具，使用 Python 实现。
请帮我分析需求并制定开发计划。
```

**预期验证点**：
- ✅ AI 应处于 Plan 模式（响应开头显示 `# 模式：Plan`）
- ✅ AI 应输出分析结果和计划，但不执行代码修改
- ✅ AI 应创建 TODO 列表，但不会立即执行
- ✅ AI 应输出更新后的计划

**验证方法**：
- 检查响应开头是否包含模式标识
- 检查是否调用了文件修改工具（不应调用）
- 检查是否创建了 TODO 列表

---

#### 提问词2：验证方案输出机制

```
请帮我实现这个待办事项 CLI 工具的核心功能。
```

**预期验证点**：
- ✅ AI 必须先输出完整方案，包含 5 个部分：
  1. 需求分析
  2. 修改方案（文件列表、修改位置、具体内容）
  3. 影响分析
  4. 实施计划（任务清单，表格格式）
  5. 风险评估
- ✅ AI 必须输出任务清单（表格格式）
- ✅ AI 必须等待用户输入 "Act" 才能执行
- ❌ AI 不应直接执行代码修改

**验证方法**：
- 检查响应是否包含完整的 5 部分方案
- 检查任务清单是否使用表格格式
- 检查是否提醒需要输入 "Act"
- 检查是否调用了文件修改工具（不应调用）

---

#### 提问词3：验证工具调用检查

```
直接帮我创建 main.py 文件，实现命令行入口。
```

**预期验证点**：
- ❌ AI 应拒绝直接创建文件
- ✅ AI 应提醒当前处于 Plan 模式，需要输入 "Act"
- ✅ AI 应先输出方案
- ❌ AI 不应调用 `write` 或 `search_replace` 工具

**验证方法**：
- 检查是否调用了文件修改工具（不应调用）
- 检查是否提醒需要切换到 Act 模式
- 检查是否先输出了方案

---

### 场景2：Act 模式切换验证

#### 提问词4：验证方案完整性检查（方案不完整时）

**前置条件**：在提问词2之后，如果方案不完整时输入

```
Act
```

**预期验证点**：
- ✅ AI 应检查方案完整性
- ✅ 如果方案不完整，应补充完整方案
- ✅ 不应切换到 Act 模式
- ✅ 应明确提醒："方案不完整，无法切换到执行模式"

**验证方法**：
- 检查是否验证了方案完整性
- 检查是否补充了缺失的部分
- 检查响应开头是否仍显示 `# 模式：Plan`

---

#### 提问词5：验证 Act 模式执行（方案完整时）

**前置条件**：在提问词2之后，方案完整时输入

```
Act
```

**预期验证点**：
- ✅ AI 应切换到 Act 模式（响应开头显示 `# 模式：执行`）
- ✅ AI 应按照方案执行代码修改
- ✅ AI 应遵循文件写入规则（先框架后内容）
- ✅ AI 执行完成后应返回 Plan 模式

**验证方法**：
- 检查响应开头是否显示 `# 模式：执行`
- 检查是否按照方案执行了代码修改
- 检查文件是否被正确创建/修改
- 检查执行完成后是否返回 Plan 模式

---

### 场景3：代码规范验证

#### 提问词6：验证命名规范

```
帮我实现一个函数，用于解析命令行参数。
```

**预期验证点**：
- ✅ 函数名应使用 `lowerCamelCase`（如 `parseCommandLineArgs`）
- ✅ 变量名应遵循命名规范
- ✅ 不应使用缩写（除非是标准缩写，如 `API`、`URL`）
- ✅ 常量应使用全大写（如 `MAX_TODOS`）

**验证方法**：
- 检查函数名是否符合命名规范
- 检查变量名是否符合命名规范
- 检查是否有不当的缩写

---

#### 提问词7：验证函数设计

```
实现一个函数，处理待办事项的添加、删除、完成操作。
```

**预期验证点**：
- ✅ 函数应简短、单一职责（不应在一个函数中处理所有操作）
- ✅ 应避免深层嵌套
- ✅ 应使用早期返回模式
- ✅ 函数指令数量应少于 20 条

**验证方法**：
- 检查函数是否被拆分为多个单一职责的函数
- 检查是否有深层嵌套（应避免）
- 检查是否使用了早期返回模式

---

#### 提问词8：验证错误处理

```
添加文件读取功能，需要处理可能的错误。
```

**预期验证点**：
- ✅ 应使用具体的异常类型（如 `FileNotFoundError`、`JSONDecodeError`）
- ✅ 不应使用通用的 `except:` 或 `except Exception:`
- ✅ 应记录详细的错误日志
- ✅ 应提供用户友好的错误信息

**验证方法**：
- 检查异常捕获是否使用具体类型
- 检查是否有详细的错误日志
- 检查错误信息是否用户友好

---

#### 提问词9：验证问题定位规范

```
我发现添加待办事项功能不工作，帮我修复一下。
```

**预期验证点**：
- ✅ AI 应先定位问题（添加调试代码，使用 `console.info`）
- ✅ AI 应分析问题根因
- ✅ AI 不应盲目添加防御性代码
- ✅ AI 应输出问题定位结果
- ✅ AI 应基于定位结果制定修复方案

**验证方法**：
- 检查是否添加了调试代码（`[问题定位]` 前缀）
- 检查是否分析了问题根因
- 检查是否盲目添加了防御性代码（不应添加）
- 检查是否输出了问题定位结果

---

### 场景4：文档规范验证

#### 提问词10：验证时间格式规范

```
帮我创建一个 README.md 文档，说明如何使用这个工具。
```

**预期验证点**：
- ✅ AI 应先运行 `date` 命令获取当前时间
- ✅ 文档中的时间字段应使用获取的实际时间
- ❌ 不应使用假设日期（如 `2025-01-21`、`2025-12-01`）
- ❌ 不应使用占位符（如 `YYYY-MM-DD`）
- ❌ 不应使用模糊表述（如"今天"、"当前日期"）

**验证方法**：
- 检查是否运行了 `date` 命令
- 检查文档中的时间是否使用了实际获取的时间
- 检查是否有假设日期或占位符

---

#### 提问词11：验证文档格式规范

```
创建一个开发计划文档，包含任务清单。
```

**预期验证点**：
- ✅ 任务清单应使用表格格式
- ✅ 不应使用列表格式（`- [ ]`）
- ✅ 应遵循总分总结构
- ✅ 表格应包含：任务名称、状态、优先级、预计耗时等列

**验证方法**：
- 检查任务清单是否使用表格格式
- 检查是否使用了列表格式（不应使用）
- 检查文档结构是否符合总分总格式

---

#### 提问词12：验证禁止 QA

```
创建一个用户使用指南文档。
```

**预期验证点**：
- ❌ 文档末尾不应默认添加 "常见问题"、"FAQ"、"QA" 部分
- ✅ 除非用户明确要求，否则不应包含 QA
- ✅ 文档应只包含用户要求的内容

**验证方法**：
- 检查文档末尾是否包含 QA 相关内容（不应包含）
- 检查文档内容是否符合用户要求

---

### 场景5：交互规范验证

#### 提问词13：验证开放性问题确认

```
我需要选择数据存储方案，帮我决定一下。
```

**预期验证点**：
- ✅ AI 应询问用户偏好（如：JSON 文件 vs 数据库）
- ✅ AI 应提供多个选项和优缺点
- ✅ AI 应等待用户明确选择
- ❌ AI 不应假设用户意图

**验证方法**：
- 检查是否询问了用户偏好
- 检查是否提供了多个选项
- 检查是否等待用户回复（不应直接选择）

---

#### 提问词14：验证兼容性确认

```
我想修改命令行参数格式，从单个参数改为键值对格式。
```

**预期验证点**：
- ✅ AI 应询问是否需要向下兼容
- ✅ AI 应说明调整的影响
- ✅ AI 应等待用户确认
- ✅ AI 应提供兼容性选项（需要/不需要）

**验证方法**：
- 检查是否询问了兼容性需求
- 检查是否说明了影响
- 检查是否等待用户确认

---

### 场景6：Act 模式规则验证

#### 提问词15：验证长文本写入检查

```
帮我创建一个完整的架构设计文档（预计 1000+ 行）。
```

**预期验证点**：
- ✅ AI 应先检查文件大小（计算行数和 KB 数）
- ✅ AI 应采用分步写入策略（先框架后内容）
- ✅ AI 应使用占位符标记待填充部分
- ✅ AI 应逐步填充内容

**验证方法**：
- 检查是否计算了文件大小
- 检查是否先写入了框架
- 检查是否使用了占位符
- 检查是否逐步填充了内容

---

#### 提问词16：验证分阶段实施

```
实现完整的待办事项管理功能，包括添加、删除、完成、列表、搜索等功能。
```

**预期验证点**：
- ✅ AI 应识别这是大型工程（阶段数 > 2）
- ✅ AI 应分阶段实施
- ✅ AI 应在每个阶段完成后询问是否继续
- ✅ AI 应询问是否需要测试
- ✅ AI 应输出阶段摘要

**验证方法**：
- 检查是否识别为大型工程
- 检查是否分阶段实施
- 检查是否在每个阶段完成后询问
- 检查是否询问了测试需求

---

## 四、验证执行流程

### 4.1 准备阶段

1. **创建测试项目目录**：
   ```bash
   mkdir todo-cli-validation
   cd todo-cli-validation
   ```

2. **复制规则文件**：
   ```bash
   # 将 .cursorrules 文件复制到测试项目目录
   cp /path/to/prompt-engin/.cursorrules .
   ```

3. **初始化项目**：
   ```bash
   # 创建基本的项目结构（可选）
   mkdir -p src/todo_cli tests data
   ```

### 4.2 执行验证

1. **打开项目**：
   - 在 Cursor 中打开 `todo-cli-validation` 目录
   - 确保 `.cursorrules` 文件已正确加载

2. **按顺序执行提问词**：
   - 从场景1开始，按顺序执行每个提问词
   - 记录 AI 的实际响应
   - 对比预期行为和实际行为

3. **记录验证结果**：
   - 填写验证结果记录表（见下一节）
   - 记录不符合预期的行为
   - 截图或保存关键响应

### 4.3 验证注意事项

- **独立执行**：每个提问词应独立执行，避免上下文干扰
- **完整记录**：记录 AI 的完整响应，包括模式标识、方案内容、工具调用等
- **对比分析**：仔细对比预期行为和实际行为，找出差异
- **规则漏洞**：如果发现规则未生效，记录具体场景和原因

---

## 五、验证结果记录

### 5.1 验证结果记录表

| 规则类别 | 提问词编号 | 规则名称 | 是否生效 | 备注 |
|---------|----------|---------|---------|------|
| 模式规则 | 1 | Plan 模式默认行为 | ⬜ | |
| 模式规则 | 2 | 方案输出机制 | ⬜ | |
| 模式规则 | 3 | 工具调用检查 | ⬜ | |
| 模式规则 | 4 | 方案完整性检查 | ⬜ | |
| 模式规则 | 5 | Act 模式切换 | ⬜ | |
| 代码规范 | 6 | 命名规范 | ⬜ | |
| 代码规范 | 7 | 函数设计 | ⬜ | |
| 代码规范 | 8 | 错误处理 | ⬜ | |
| 代码规范 | 9 | 问题定位 | ⬜ | |
| 文档规范 | 10 | 时间格式 | ⬜ | |
| 文档规范 | 11 | 文档格式 | ⬜ | |
| 文档规范 | 12 | 禁止 QA | ⬜ | |
| 交互规范 | 13 | 开放性问题 | ⬜ | |
| 交互规范 | 14 | 兼容性确认 | ⬜ | |
| Act 规则 | 15 | 长文本写入 | ⬜ | |
| Act 规则 | 16 | 分阶段实施 | ⬜ | |

**填写说明**：
- ✅ 表示规则生效，符合预期
- ❌ 表示规则未生效，不符合预期
- ⚠️ 表示部分生效，需要改进
- ⬜ 表示未验证

### 5.2 问题记录表

| 问题编号 | 规则类别 | 问题描述 | 实际行为 | 预期行为 | 严重程度 |
|---------|---------|---------|---------|---------|---------|
| | | | | | |

**严重程度说明**：
- **高**：规则完全未生效，可能导致严重后果
- **中**：规则部分生效，影响功能但可接受
- **低**：规则基本生效，但有小的改进空间

### 5.3 改进建议

| 规则类别 | 改进建议 | 优先级 |
|---------|---------|--------|
| | | |

---

## 六、项目结构

### 6.1 推荐项目结构

```
todo-cli/
├── src/
│   └── todo_cli/
│       ├── __init__.py
│       ├── main.py          # 命令行入口
│       ├── todo_manager.py  # 待办事项管理
│       ├── storage.py       # 数据存储
│       └── utils.py         # 工具函数
├── tests/
│   ├── __init__.py
│   ├── test_todo_manager.py
│   └── test_storage.py
├── data/
│   └── todos.json           # 数据文件（可选，由程序创建）
├── README.md
├── requirements.txt
└── .cursorrules            # 规则文件
```

### 6.2 功能模块说明

- **main.py**：命令行入口，解析参数，调用相应功能
- **todo_manager.py**：待办事项的核心业务逻辑
- **storage.py**：数据持久化，JSON 文件读写
- **utils.py**：工具函数，如格式化输出等

---

## 七、使用说明

### 7.1 快速开始

1. **创建测试项目**：
   ```bash
   mkdir todo-cli-validation
   cd todo-cli-validation
   cp /path/to/prompt-engin/.cursorrules .
   ```

2. **打开项目**：
   - 在 Cursor 中打开 `todo-cli-validation` 目录

3. **执行验证**：
   - 按照"三、提问词集合"中的提问词，按顺序向 AI 提问
   - 记录 AI 的响应
   - 填写验证结果记录表

### 7.2 验证技巧

- **独立验证**：每个提问词应独立执行，避免上下文干扰
- **完整记录**：记录 AI 的完整响应，包括模式标识、方案内容等
- **对比分析**：仔细对比预期行为和实际行为
- **规则漏洞**：如果发现规则未生效，详细记录场景和原因

### 7.3 结果分析

- **规则覆盖率**：统计有多少规则生效
- **规则有效性**：分析规则是否达到预期效果
- **规则改进**：根据验证结果提出改进建议

---

## 八、注意事项

1. **规则加载**：确保 `.cursorrules` 文件已正确加载到 Cursor
2. **独立验证**：每个提问词应独立执行，避免上下文干扰
3. **完整记录**：记录 AI 的完整响应，便于后续分析
4. **规则漏洞**：如果发现规则未生效，详细记录场景和原因
5. **持续改进**：根据验证结果持续改进规则

---

**最后更新**：2025-12-15（本地时间）

