---
name: exception-handling
description: 例外情况的处理流程，包括明显的语法错误、已知的简单问题等例外情况
priority: 4
tags: ['mode', 'exception', 'handling']
---

# 例外情况的处理流程

## 使用场景

当用户需要：
- 遇到明显错误时
- 处理简单问题时
- 紧急修复时

## 触发条件

以下情况自动应用此规范：
- 检测到明显的语法错误时
- 遇到已知的简单问题时
- 需要快速修复时

## 与其他规则的配合

- 与 `problem-location` 配合：复杂问题仍需定位
- 与核心规则配合使用

---

> **文件说明**：本文件包含例外情况的处理流程
> **规则来源**：rules/stages/common/mode/plan/exception-handling.md

---

- **例外情况1：明显的语法错误**
  - **可以跳过**：详细定位
  - **仍需输出**：简化版方案（至少说明：要修复什么问题、如何修复、修复的文件）
  - **不需要**：完整的 5 部分方案
  
- **例外情况2：已知的简单问题**
  - **可以跳过**：详细定位
  - **仍需输出**：简化版方案（至少说明：要修复什么问题、如何修复、修复的文件）
  - **不需要**：完整的 5 部分方案
  
- **例外情况3：紧急修复（Hotfix）**
  - **可以跳过**：详细定位（修复后必须补充）
  - **仍需输出**：简化版方案（至少说明：要修复什么问题、如何修复、修复的文件）
  - **不需要**：完整的 5 部分方案（修复后必须补充完整方案）
  
- **例外情况4：重复出现的问题**
  - **可以跳过**：详细定位（之前已定位过）
  - **仍需输出**：简化版方案（至少说明：要修复什么问题、如何修复、修复的文件）
  - **不需要**：完整的 5 部分方案（可以引用之前的方案）

- **简化版方案的最低要求**：
  - **问题描述**：简要说明要修复什么问题
  - **修复方案**：简要说明如何修复（代码示例或说明）
  - **修复文件**：列出要修改的文件

- **即使属于例外情况**：
  - ⚠️ 必须明确说明为什么可以跳过详细定位
  - ⚠️ 建议先简要定位问题，确保修复正确
  - ⚠️ 修复后必须验证修复效果
  - ⚠️ 必须输出简化版方案（至少包含问题描述、修复方案、修复文件）

### 使用场景示例

#### 示例1：明显的语法错误

**场景**：代码中存在明显的语法错误，如缺少括号、拼写错误等

**处理流程**：
```
1. 识别为明显的语法错误（SyntaxError）
2. 说明为什么可以跳过详细定位："检测到明显的语法错误，错误信息明确指向语法问题"
3. 输出简化版方案：
   - 问题描述：缺少右括号导致语法错误
   - 修复方案：在第 45 行添加右括号 `)`
   - 修复文件：src/utils/helper.js
4. 执行修复
5. 验证修复效果（运行代码检查）
```

**简化版方案示例**：
```markdown
## 简化版修复方案

**问题描述**：
- 文件 `src/utils/helper.js` 第 45 行缺少右括号，导致语法错误
- 错误信息：`SyntaxError: Unexpected token`

**修复方案**：
- 在第 45 行 `if (condition {` 后添加右括号 `)`
- 修改为：`if (condition) {`

**修复文件**：
- `src/utils/helper.js`（第 45 行）
```

#### 示例2：已知的简单问题

**场景**：配置项名称错误，之前遇到过相同问题

**处理流程**：
```
1. 识别为已知的简单问题（配置项名称错误）
2. 说明为什么可以跳过详细定位："这是已知的简单问题，修复方式明确（不超过 5 行代码）"
3. 输出简化版方案：
   - 问题描述：配置文件中的数据库连接字符串配置项名称错误
   - 修复方案：将 `db_url` 改为 `database_url`
   - 修复文件：config/database.yml
4. 执行修复
5. 验证修复效果（检查配置是否正确加载）
```

**简化版方案示例**：
```markdown
## 简化版修复方案

**问题描述**：
- 配置文件 `config/database.yml` 中的数据库连接字符串配置项名称错误
- 应使用 `database_url`，但使用了 `db_url`

**修复方案**：
- 将第 12 行的 `db_url: "postgresql://..."` 改为 `database_url: "postgresql://..."`

**修复文件**：
- `config/database.yml`（第 12 行）
```

#### 示例3：紧急修复（Hotfix）

**场景**：生产环境紧急问题，需要快速修复

**处理流程**：
```
1. 识别为紧急修复场景
2. 说明为什么可以跳过详细定位："生产环境紧急问题，需要快速修复。修复后将补充详细定位。"
3. 输出简化版方案：
   - 问题描述：API 接口返回 500 错误，日志显示空指针异常
   - 修复方案：添加空值检查，避免空指针异常
   - 修复文件：src/api/user.js
4. 执行修复
5. 验证修复效果（测试 API 接口）
6. 修复后补充详细定位和完整方案
```

**简化版方案示例**：
```markdown
## 简化版修复方案（紧急修复）

**问题描述**：
- 生产环境 API 接口 `/api/user/:id` 返回 500 错误
- 日志显示：`TypeError: Cannot read property 'name' of null`

**修复方案**：
- 在 `src/api/user.js` 第 28 行添加空值检查
- 修改前：`return user.name;`
- 修改后：`return user ? user.name : null;`

**修复文件**：
- `src/api/user.js`（第 28 行）

**注意**：修复后将补充详细的问题定位和完整的修复方案。
```

#### 示例4：重复出现的问题

**场景**：之前已经定位过相同的问题，有明确的修复方案

**处理流程**：
```
1. 识别为重复出现的问题
2. 说明为什么可以跳过详细定位："之前已经定位过相同的问题（问题ID: #123），有明确的修复方案"
3. 引用之前的方案："参考问题 #123 的修复方案"
4. 输出简化版方案：
   - 问题描述：与问题 #123 相同，环境变量未正确传递
   - 修复方案：在脚本开头添加 `export ENV_VAR`
   - 修复文件：scripts/deploy.sh
5. 执行修复
6. 验证修复效果
```

**简化版方案示例**：
```markdown
## 简化版修复方案（重复问题）

**问题描述**：
- 与问题 #123 相同：环境变量 `ENV_VAR` 未正确传递到脚本中
- 之前已定位：环境变量在脚本执行时未导出

**修复方案**：
- 参考问题 #123 的修复方案
- 在 `scripts/deploy.sh` 第 5 行添加：`export ENV_VAR`

**修复文件**：
- `scripts/deploy.sh`（第 5 行）

**参考**：问题 #123 的完整定位和修复方案
```
