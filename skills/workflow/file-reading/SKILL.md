---
name: file-reading
description: 大文件读取策略，对于大文件的读取应采用阶段性读取策略
priority: 4
tags: ['mode', 'file', 'reading']
---

# 大文件读取策略

## 使用场景

当用户需要：
- 读取大文件时
- 文件超过 1000 行时
- 需要分段读取时

## 触发条件

以下情况自动应用此规范：
- 检测到文件行数超过 1000 行时
- 用户要求读取大文件时

## 与其他规则的配合

- 与核心规则配合使用

---

> **文件说明**：本文件包含大文件读取的策略和规范
> **规则来源**：rules/stages/common/mode/plan/file-reading.md

---

对于大文件的读取，应采用**阶段性读取**策略，避免一次性读取整个文件：

- **适用场景**：
  - 文件内容超过 1000 行或 50KB
  - 需要分析文件结构或特定部分
  - 文件内容可能包含大量重复或无关信息
  
- **操作流程**：
  1. **第一步：先读取文件头部**
     - 先读取文件的前 50-100 行，了解文件基本结构
     - 识别文件类型、编码格式、主要模块或章节
     - 评估文件大小和复杂度
     - 确定是否需要分块读取
  
  2. **第二步：按需分块读取**
     - 如果文件较大（>1000行），使用 `offset` 和 `limit` 参数分块读取
     - 每次读取建议 200-500 行，避免单次读取过多内容
     - 按照逻辑模块或章节顺序读取，而不是简单按行数分割
     - 读取每个块后，先分析是否需要继续读取下一块
  
  3. **第三步：选择性读取**
     - 如果只需要文件的特定部分，直接使用 `offset` 和 `limit` 读取目标区域
     - 使用 `grep` 或 `codebase_search` 先定位目标内容的位置
     - 避免读取整个文件后再筛选，优先精确定位
  
- **读取策略选择**：
  - **小文件**（<500行）：可以直接读取整个文件
  - **中等文件**（500-1000行）：先读取头部，再决定是否需要完整读取
  - **大文件**（>1000行）：必须分块读取，每次读取 200-500 行
  - **超大文件**（>5000行）：优先使用搜索工具定位，只读取相关部分
  
- **优势**：
  - ✅ 避免一次性读取过大内容导致响应缓慢
  - ✅ 提高处理效率，只读取需要的内容
  - ✅ 降低内存占用，避免资源浪费
  - ✅ 支持渐进式分析，逐步理解文件结构

### 使用场景示例

#### 示例1：读取大型配置文件

**场景**：需要读取一个 2000 行的配置文件，了解其结构

**执行流程**：
```typescript
// 第一步：读取文件头部（前 100 行）
read_file({
  target_file: 'config.json',
  offset: 1,
  limit: 100
});

// 分析：发现配置文件包含多个模块，每个模块约 300 行

// 第二步：按模块读取
read_file({
  target_file: 'config.json',
  offset: 1,
  limit: 300  // 读取第一个模块
});

read_file({
  target_file: 'config.json',
  offset: 301,
  limit: 300  // 读取第二个模块
});

// 继续按需读取其他模块...
```

#### 示例2：分析大型代码文件

**场景**：需要分析一个 5000 行的代码文件，查找特定函数

**执行流程**：
```typescript
// 第一步：使用搜索工具定位目标内容
grep({
  pattern: 'function targetFunction',
  path: 'large-file.js'
});
// 返回：目标函数在第 2345 行

// 第二步：只读取目标函数所在区域（前后各 50 行）
read_file({
  target_file: 'large-file.js',
  offset: 2295,  // 2345 - 50
  limit: 100     // 读取 100 行
});

// 避免读取整个 5000 行的文件
```

#### 示例3：读取大型文档文件

**场景**：需要读取一个 3000 行的 Markdown 文档，了解其结构

**执行流程**：
```typescript
// 第一步：读取文件头部（前 50 行）
read_file({
  target_file: 'documentation.md',
  offset: 1,
  limit: 50
});

// 分析：发现文档包含 10 个主要章节，每个章节约 300 行

// 第二步：按章节读取
read_file({
  target_file: 'documentation.md',
  offset: 51,
  limit: 300  // 读取第一章
});

// 如果只需要特定章节，直接读取该章节
read_file({
  target_file: 'documentation.md',
  offset: 1051,  // 第四章开始位置
  limit: 300      // 读取第四章
});
```
