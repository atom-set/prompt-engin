---
name: compatibility-check
description: 技术方案调整的兼容性确认机制，涉及技术方案调整时必须明确询问用户是否需要向下兼容
priority: 4
tags: ['mode', 'compatibility', 'planning']
---

# 技术方案调整的兼容性确认机制

## 使用场景

当用户需要：
- 调整技术方案时
- 修改现有功能时
- 重构代码时
- 升级版本时

## 触发条件

以下情况自动应用此规范：
- 检测到技术方案调整时
- 用户要求修改现有功能时
- 重构可能影响兼容性时

## 与其他规则的配合

- 与核心规则配合使用

---

> **文件说明**：本文件包含技术方案调整的兼容性确认机制
> **规则来源**：rules/stages/common/mode/plan/compatibility-check.md

---

当涉及技术方案调整时，必须明确询问用户是否需要向下兼容，得到用户反馈后再执行：

- **适用场景**：
  - 修改现有 API 接口（参数变更、返回值变更、接口废弃等）
  - 调整数据结构（字段变更、类型变更、结构重构等）
  - 变更配置项（配置项名称、类型、默认值等）
  - 修改函数签名（参数变更、返回值变更等）
  - 重构代码结构（模块拆分、合并、重命名等）
  - 其他可能影响现有代码或使用方式的调整

- **确认流程**：
  1. **识别调整影响**：
     - 分析技术方案调整可能对现有代码的影响
     - 识别可能破坏兼容性的变更点
     - 评估影响范围和严重程度
  
  2. **明确提问**：
     - 必须明确询问："此技术方案调整是否需要向下兼容？"
     - 说明调整的具体内容和可能的影响
     - 提供兼容性选项：
       - **需要向下兼容**：保留旧接口/方法/配置，新增新接口/方法/配置，或使用适配层
       - **不需要向下兼容**：直接修改，可能影响现有代码，需要同步更新所有调用方
  
  3. **等待用户反馈**：
     - 必须等待用户明确回复后再继续
     - 不能假设用户意图（如默认需要或不需要兼容）
     - 如果用户未明确回复，应再次询问或提供更详细的说明
  
  4. **根据反馈调整方案**：
     - **需要向下兼容**：
       - 保留旧版本接口/方法/配置
       - 新增新版本接口/方法/配置
       - 提供迁移指南或适配层
       - 标记旧版本为废弃（deprecated），给出迁移时间表
     - **不需要向下兼容**：
       - 直接进行修改
       - 明确说明需要同步更新的调用方
       - 提供变更清单和迁移步骤

- **提问格式要求**：
  - 使用清晰、明确的问题表述
  - 说明调整的具体内容和影响
  - 提供明确的选项（需要/不需要）
  - 必要时提供示例说明

- **重要原则**：
  - ✅ **强制要求**：涉及技术方案调整时，必须询问兼容性需求
  - ✅ **明确提问**：不能使用模糊表述，必须明确询问是否需要向下兼容
  - ✅ **等待反馈**：必须得到用户明确回复后才能继续
  - ❌ **禁止假设**：不能假设用户意图，不能默认选择兼容或不兼容
  - ❌ **禁止跳过**：不能跳过兼容性确认直接执行调整

- **示例提问**：
  ```
  此技术方案涉及以下调整：
  - 修改 API 接口参数结构（从单个参数改为对象参数）
  - 调整配置项名称（从 `oldConfig` 改为 `newConfig`）
  
  这些调整可能会影响现有代码的调用。
  
  **请确认：此技术方案调整是否需要向下兼容？**
  - 需要向下兼容：保留旧接口/配置，新增新接口/配置，提供迁移方案
  - 不需要向下兼容：直接修改，需要同步更新所有调用方
  ```

